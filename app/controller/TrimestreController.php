<?php class Trimestre extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }            public function admin_listar(){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){             $filiais=$acesso->acesso_filial(__CLASS__);            $status= new StatusModel();            $filial = new FilialModel();                       $acesso = new SessionHelper();                       $trimestre = new TrimestreModel();                      if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                        $form = new FormularioHelper();                 $inputs = $form->Listar("col-md-12", null, "/".__CLASS__."/form/", $icone,$trimestre->listar_Trimestre("INNER JOIN Status ON Status.id = Trimestre.id_status",NULL,"Trimestre.id_status<>99 AND {$filiais}",NULL,' Trimestre.id DESC',"Trimestre.id,Trimestre.descricao AS Trimestre,Trimestre.data_inicial,Trimestre.data_final,Status.cor AS cor_Status,Status.Descricao AS Status,Trimestre.data_lancamento AS Lancamneto",null,$pesquisa), "tabela1", array(array("acao"=>"/".__CLASS__."/form/","classe"=>"btn-sm btn-warning","icone"=>"edit"),array("acao"=>"/".__CLASS__."/visualizar/","classe"=>"btn-sm btn-rose","icone"=>"remove_red_eye"),array("acao"=>"/Logs/form/","classe"=>"btn-sm btn-danger","icone"=>"close")));            $form->card($nome_form,$inputs,"col-md-12",$comando,"POST","queue_play_next");          }else{            $this->view('error_permisao');        }        }        public function form(){         $this->acesso_restrito();        $acesso = new AcessoHelper();                 $comando="/".__CLASS__."/incluir/";          if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){                $logs = new LogsModel();            $status= new StatusModel();            $filial = new FilialModel();            $programa = new ProgramaModel();            $trimestre= new TrimestreModel();             $acesso = new SessionHelper();            $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();            $id=$this->getParams("id");                 $nome_form="Cadastra Trimestre";                      if(!empty($id)){                $trimestre_dados=$trimestre->listar_Trimestre($join, "1", "id='$id'", $offset, $orderby);                $trimestre_dados= $trimestre_dados[0];                 $comando="/".__CLASS__."/alterar/";                $nome_form="Alterar Trimestre";            }                         $form = new FormularioHelper($nome_form,"col-md-12" ,$comando,"POST","people");            $inputs .= $form->Input("hidden", "id", null, $id, $Required, null, $disable);            $inputs .= $form->select("Status","id_filial", "col-md-2", $filial->listar_Filial(NULL,NULL,"id_status<>'99'",NULL,' Filial.id ASC',NULL),"nome_fantasia");            $inputs .= $form->Input("text", "descricao", "col-md-10", $trimestre_dados["descricao"], $Required, "Descrição", $disable);            $inputs .= $form->Input("date", "data_inicial", "col-md-5", $trimestre_dados["data_inicial"], $Required, "Data Inicial", $disable);            $inputs .= $form->Input("date", "data_final", "col-md-5", $trimestre_dados["data_final"], $Required, "Data Final", $disable);            $inputs .= $form->select("Status","id_status", "col-md-2", $status->listar_Status(NULL,NULL,"id_status<>99 AND tabela='Geral'",NULL,' Status.id ASC',NULL),"descricao");            $inputs .= $form->Button("btn btn-md btn-rose ","Salvar");            $form->card($nome_form,$inputs,"col-md-12",$comando,"POST","queue_play_next");          }else{           $this->view('error_permisao');        }       }     public function incluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Trimestre/incluir/';                   if($acesso->acesso_valida($comando)==true){            $trimestre = new TrimestreModel();                  $id=$trimestre->cadastrar_trimestre(                 array(                    'descricao'=>$_POST['descricao'],                   'id_filial'=>$_POST['id_filial'],                    'data_inicial'=>$_POST['data_inicial'],                    'data_final'=>$_POST['data_final'],                    'id_status'=>$_POST['id_status'],                    'data_lancamento'=>date('Y-m-d H:i:s'),                )            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Trimestre/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function alterar(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Trimestre/alterar/';        if($acesso->acesso_valida($comando)==true){            $id = $_POST['id'];            $trimestre = new TrimestreModel();                  $trimestre->alterar_trimestre(               array(                    'descricao'=>$_POST['descricao'],                    'data_inicial'=>$_POST['data_inicial'],                    'data_final'=>$_POST['data_final'],                    'id_status'=>$_POST['id_status'],                    'data_lancamento'=>date('Y-m-d H:i:s'),                ),'id='.$id            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Trimestre/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Trimestre/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $trimestre = new TrimestreModel();                  $trimestre->excluir_trimestre( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Trimestre/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 