<?php class Receituario extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }     //    public function admin_listar(){//        $this->acesso_restrito();//        $acesso = new AcessoHelper();//        $logs = new LogsModel();//        $comando="/".__CLASS__."/incluir/";         //        if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){ //            $filiais=$acesso->acesso_filial(__CLASS__);//            $status= new StatusModel();//            $filial = new FilialModel();           //            $acesso = new SessionHelper();           //            $modelo = new ReceituarioModel();//            if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }//            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);        //            echo $menu->Menu();            //            $form = new FormularioHelper(__CLASS__,"col-md-12" ,null,null,"people");     //            echo $form->Listar("col-md-12", null, "/".__CLASS__."/form/", $icone,$modelo->listar_Receituario("INNER JOIN Filial ON Filial.id=Receituario.id_filial INNER JOIN Status ON Status.id=Receituario.id_status ",NULL,"Receituario.id_status<>'99' AND ({$filiais})",NULL,' Receituario.id DESC',"Receituario.id,Filial.nome_fantasia AS Filial,Receituario.descricao AS Receituario,Status.cor AS cor_Status,Status.Descricao AS Status",NULL,$pesquisa), "tabela1", array(array("acao"=>"/".__CLASS__."/form/","classe"=>"btn-sm btn-warning","icone"=>"edit"),array("acao"=>"/".__CLASS__."/visualizar/","classe"=>"btn-sm btn-rose","icone"=>"remove_red_eye"),array("acao"=>"/Logs/form/","classe"=>"btn-sm btn-danger","icone"=>"close")));//        }else{////            $this->view('error_permisao');////        }    ////    }         public function form(){                 $this->acesso_restrito();                $acesso = new AcessoHelper();        $logs = new LogsModel();             $comando="/".__CLASS__."/incluir/";                //if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){            $status= new StatusModel();            $filial = new FilialModel();                          $receituario = new ReceituarioModel();            $acesso = new SessionHelper();            $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                   $id_cliente=$this->getParams("id_cliente");                $dados["id_cliente"]=$id_cliente;                  if(!empty($id)){              //  $receituario_dados=$receituario->listar_Receituario($join, "1", "id='$id'", $offset, $orderby);                                $receituario_dados= $receituario_dados[0];                 $comando="/".__CLASS__."/alterar/";            }                                    $this->view("form_receituario",$dados);       // }else{       //        $this->view('error_permisao');        //   }       } public function incluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Receituario/incluir/';       // if($acesso->acesso_valida($comando)==true){            $receituario = new ReceituarioModel();                  $id_cliente=$_POST['id_cliente'];            echo $id_cliente;            $id=$receituario->cadastrar_Receituario(                 array(                    'id_cliente'=>$id_cliente,                    'id_colaborador'=>$_POST['id_colaborador'],                    'texto'=>$_POST['texto'],                    'data_receita'=>$_POST['data_receita'],                                        'data_lancamento'=>  date("Y-m-d H:i:s"),                    'id_status'=>  "1",                )            );             echo "ID:".$id;            $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();           $redirect->goToUrl("/Pessoa/visualizar/tabela/Cliente/id/$id_cliente");         //   }else{      //      $this->view('error_permisao');     //   }    }// public function alterar(){    //        $this->acesso_restrito();//        $acesso = new AcessoHelper(); //        $logs = new LogsModel();//        $comando='/Receituario/alterar/';//        //        if($acesso->acesso_valida($comando)==true){//            $id = $_POST['id'];//            //            $modelo = new ReceituarioModel();      //            $modelo->alterar_modelo(//                array(//                        'id_filial'=>$_POST['id_filial'],//                        'descricao'=>$_POST['descricao'],//                        'id_status'=>$_POST['id_status'],//                       'data_lancamento'=>  date("Y-m-d H:i:s"),//                ),'id='.$id//            );  //            $logs->cadastrar_logs($comando,$id);//Gera Logs//            $redirect = new RedirectHelper();//            $redirect->goToUrl('/Receituario/admin_listar/');    //        }else{////            $this->view('error_permisao');//        }//    } public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Receituario/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $modelo = new ReceituarioModel();                  $modelo->excluir_modelo( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Receituario/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 