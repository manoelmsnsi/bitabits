<?php class Procedimentos extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }           public function form(){         $this->acesso_restrito();        $acesso = new AcessoHelper();                $comando="/".__CLASS__."/incluir/";      //    if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){                $logs = new LogsModel();             $status= new StatusModel();            $filial = new FilialModel();                      $pessoa = new PessoaModel();            $atestado = new AtestadoModel();                       $acesso = new SessionHelper();            $id=$this->getParams("id");                 $nome_form="Cadastrar Procedimento";              if(!empty($id)){                 $procedimentos_dados=$procedimentos->listar_Procedimentos($join, "1", "id='$id'", $offset, $orderby);                                $procedimentos_dados= $procedimentos_dados[0];                 $comando="/".__CLASS__."/alterar/";                $nome_form="Alterar Procedimento";            }                         $menu = new MenuHelper("Bit", $Class, $AcaoForm, $MetodoDeEnvio);                  echo $menu->Menu();            $form = new FormularioHelper();                $inputs.= $form->Input("hidden", "id", $Classe, $id);                $inputs.= $form->Input("hidden", "id_cliente", $Classe,  $this->getParams("id_cliente"));                          $inputs.= $form->select("Colaborador","id_colaborador", "col-md-5",$pessoa->listar_Pessoa(NULL,NULL,"Pessoa.id_status<>99 AND Pessoa.tipo='Colaborador'",NULL,' Pessoa.id DESC',"Pessoa.nome,Pessoa.id"),"nome",$atestado_dados["id_colaborador"]);                $inputs.= $form->Input("date", "data", "col-md-2", $atestado_dados["data_atestado"], $Required, "Data", $disable);                $inputs.= $form->select("Status","id_status", "col-md-5", $status->listar_Status(NULL,NULL,"id_status<>99 AND tabela='Geral'",NULL,' Status.id ASC',NULL),"descricao");                $inputs.= $form->Text("text", "listar_procedimentos", "col-md-12", $atestado_dados["texto"], $Required, "Atestado", $disable);                $inputs.= $form->Button("btn btn-md btn-rose ","Salvar");                $form->card($nome_form,$inputs,"col-md-12",$comando,"POST","add_business");      //  }else{     //      $this->view('error_permisao');    //    }       } public function incluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Procedimentos/incluir/';                 // if($acesso->acesso_valida($comando)==true){            $procedimentos = new ProcedimentosModel();                  $id_cliente=$_POST['id_cliente'];            echo $id_cliente;            $id=$procedimentos->cadastrar_Procedimentos(                 array(                    'id_cliente'=>$id_cliente,                    'id_colaborador'=>$_POST['id_colaborador'],                    'listar_procedimentos'=>$_POST['listar_procedimentos'],                        'data'=>$_POST['data'],                        'data_lancamento'=>  date("Y-m-d H:i:s"),                    'id_status'=>  "1",                )            );             echo "ID:".$id;            $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();           $redirect->goToUrl("/Pessoa/visualizar/tabela/Cliente/id/$id_cliente");         //   }else{      //      $this->view('error_permisao');     //   }    } public function alterar(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Procedimentos/alterar/';                if($acesso->acesso_valida($comando)==true){            $id = $_POST['id'];                        $modelo = new ProcedimentosModel();                  $modelo->alterar_modelo(                array(                    'id_cliente'=>$id_cliente,                    'id_colaborador'=>$_POST['id_colaborador'],                    'listar_procedimentos'=>$_POST['listar_procedimentos'],                       'data'=>$_POST['data'],                     'data_lancamento'=>  date("Y-m-d H:i:s"),                ),'id='.$id            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Procedimentos/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Procedimentos/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $modelo = new ProcedimentosModel();                  $modelo->excluir_modelo( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Procedimentos/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 