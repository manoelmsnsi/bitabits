<?php class Mesa extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }       public function admin_listar(){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){             $filiais=$acesso->acesso_filial(__CLASS__);            $status= new StatusModel();            $filial = new FilialModel();                       $acesso = new SessionHelper();                       $mesa = new MesaModel();                        if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                        $form = new FormularioHelper(__CLASS__,"col-md-12" ,null,null,"people");                 $inputs= $form->Listar("col-md-12", null, "/".__CLASS__."/form/", $icone,$mesa->listar_Mesa(NULL,NULL,"id_status<>99 AND {$filiais}",NULL,' Mesa.id DESC',NULL,NULL,$pesquisa), "tabela1", array(array("acao"=>"/".__CLASS__."/form/","classe"=>"btn-sm btn-warning","icone"=>"edit"),array("acao"=>"/".__CLASS__."/visualizar/","classe"=>"btn-sm btn-rose","icone"=>"remove_red_eye"),array("acao"=>"/Logs/form/","classe"=>"btn-sm btn-danger","icone"=>"close")));            $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","tab");        }else{            $this->view('error_permisao');        }        }    public function resturante(){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){             $filiais=$acesso->acesso_filial(__CLASS__);            $status= new StatusModel();            $filial = new FilialModel();                       $acesso = new SessionHelper();                       $mesa = new MesaModel();                        if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                        $form = new FormularioHelper(__CLASS__,"col-md-12" ,null,null,"people");                 $dados_mesa=$mesa->listar_Mesa("INNER JOIN Status ON Status.id=Mesa.id_status",NULL,"Mesa.id_status<>99 AND {$filiais}",NULL,' Mesa.id DESC',"Mesa.id,Mesa.descricao,Mesa.data_lancamento,Status.cor as cor_Status,Status.descricao AS Status",NULL,$pesquisa);            foreach ($dados_mesa AS $mesas):                echo "<div class='col-md-4' >";                    echo $form->MiniCard(array(                               array("css"=>"col-md-12","cor"=>"$mesas[cor_Status]","icone"=>"deck","nome"=>"$mesas[descricao]","valor"=>"<h6 class='card-title'>$mesas[id]</h6>","footer"=>"$mesas[data_lancamento]"),                    ));                echo "</div>";            endforeach;            //$form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","tab");        }else{            $this->view('error_permisao');        }        }       public function visualizar(){           $this->acesso_restrito();           $acesso = new AcessoHelper();            $logs = new LogsModel();           $comando='/Mesa/visualizar/';           if($acesso->acesso_valida($comando)==true){                 $id = $this->getParams('id');                $acesso = new SessionHelper();                $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                        echo $menu->Menu();                              $mesa = new MesaModel();               $listar_mesa = $mesa->listar_Mesa("INNER JOIN Status ON Status.id = Mesa.id_status",NULL,"Mesa.id_status<>'99'",NULL,' Mesa.id DESC',"Mesa.descricao AS descricao_mesa, Status.descricao as descricao_status,Status.cor");               $dados['listar_mesa'] = $listar_mesa;                 $logs->cadastrar_logs($comando,'0');//Gera Logs               $this->view('form_visualizar_mesa',$dados);            }else{               $this->view('error_permisao');           }       }        public function pedido_mesa(){           $this->acesso_restrito();           $acesso = new AcessoHelper();            $logs = new LogsModel();           $comando='/Mesa/pedido_mesa/';           if($acesso->acesso_valida($comando)==true){                 $id = $this->getParams('id');                $acesso = new SessionHelper();                $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                        echo $menu->Menu();                $produto = new ProdutoModel();                $listar_pedido_mesa = $produto->listar_Produto("INNER JOIN Status ON Status.id = Produto.id_status INNER JOIN Upload ON Upload.id_tabela=Produto.id",NULL,"Produto.id_status<>'99' AND Upload.tabela='Produto'",NULL,' Produto.id DESC',"Produto.descricao AS descricao_produto, Status.descricao as descricao_status, Upload.src");                $dados['listar_pedido_mesa'] = $listar_pedido_mesa;                  $logs->cadastrar_logs($comando,'0');//Gera Logs                $this->view('form_visualizar_pedido_mesa',$dados);            }else{               $this->view('error_permisao');           }       }        public function pedido_mesa_composicao(){           $this->acesso_restrito();           $acesso = new AcessoHelper();            $logs = new LogsModel();           $comando='/Mesa/pedido_mesa/';//pedido_mesa_composicao           if($acesso->acesso_valida($comando)==true){                 $id = $this->getParams('id');               $acesso = new SessionHelper();                $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                        echo $menu->Menu();                                          $composicao = new ComposicaoModel();               $listar_composicao = $composicao->listar_Composicao("INNER JOIN Status ON Status.id = Composicao.id_status INNER JOIN Upload ON Upload.id_tabela=Composicao.id",NULL,"Composicao.id_status<>'99' AND Upload.tabela='Composicao'",NULL,' Composicao.id DESC',"Composicao.descricao AS descricao_composicao, Status.descricao as descricao_status, Upload.src");               $dados['listar_composicao'] = $listar_composicao;                               $logs->cadastrar_logs($comando,'0');//Gera Logs               $this->view('form_visualizar_pedido_mesa_composicao',$dados);            }else{               $this->view('error_permisao');           }       }        public function form(){         $this->acesso_restrito();        $acesso = new AcessoHelper();                    $comando='/'.__CLASS__.'/incluir/';                 if($acesso->acesso_valida('/'.__CLASS__.'/admin_listar/')==true){                   $filial = new FilialModel();        $status = new StatusModel();        $mesa = new MesaModel();        $id = $this->getParams('id');        $dados['id']=$id;        $nome_form='Cadastra Mesa';        $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                echo $menu->Menu();        if(!empty($id)){             $mesa_dados=$mesa->listar_Mesa($JOIN, '1', "id='$id'", $offset, $orderby);            $mesa_dados = $marca_dados[0];             $comando='/'.__CLASS__.'/alterar/';            $nome_form='Alterar Mesa';        }         $form = new FormularioHelper($nome_form,'col-md-12' ,$comando,'POST','people');            $inputs.= $form->Input('hidden', 'id', $CSS, $id);            $inputs.= $form->select('Filial','id_filial',"col-md-2",$filial->listar_Filial(NULL,NULL,"id_status<>'99'",NULL,NULL,NULL,null,null),'nome_fantasia',$mesa_dados['id_status']);            $inputs.= $form->Input("text", 'descricao', "col-md-6", $mesa_dados["descricao"], $Required, 'descricao', $disable);            $inputs.= $form->select('Status',"id_status",'col-md-2',$status->listar_Status(NULL,NULL,"id_status<>'99'",NULL,NULL,NULL,null,null),'descricao',$mesa_dados['id_status']);            $inputs.= $form->Button("btn btn-md btn-rose ","Salvar");                 $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","ballot");        }else{            $this->view('error_permisao');        }    }    public function incluir(){               $this->acesso_restrito();           $acesso = new AcessoHelper();            $logs = new LogsModel();           $comando='/Mesa/incluir/';          if($acesso->acesso_valida($comando)==true){               $mesa = new MesaModel();                     $id=$mesa->cadastrar_mesa(                    array(                        'id_filial'=>$_POST['id_filial'],                        'descricao'=>$_POST['descricao'],                        'id_status'=>$_POST['id_status'],                       'data_lancamento'=>  date("Y-m-d H:i:s"),                   )               );                $logs->cadastrar_logs($comando,$id);//Gera Logs               $redirect = new RedirectHelper();               $redirect->goToUrl('/Mesa/admin_listar/');               }else{               $this->view('error_permisao');           }       }    public function alterar(){               $this->acesso_restrito();           $acesso = new AcessoHelper();            $logs = new LogsModel();           $comando='/Mesa/alterar/';           if($acesso->acesso_valida($comando)==true){               $id = $_POST['id'];               $mesa = new MesaModel();                     $mesa->alterar_mesa(                   array(                        'id_filial'=>$_POST['id_filial'],                        'descricao'=>$_POST['descricao'],                        'id_status'=>$_POST['id_status'],                        'data_lancamento'=>  date("Y-m-d H:i:s"),                   ),'id='.$id               );                 $logs->cadastrar_logs($comando,$id);//Gera Logs               $redirect = new RedirectHelper();               $redirect->goToUrl('/Mesa/admin_listar/');               }else{               $this->view('error_permisao');           }       }    public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Mesa/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $mesa = new MesaModel();                  $mesa->excluir_mesa( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs           $redirect = new RedirectHelper();            $redirect->goToUrl('/Mesa/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 