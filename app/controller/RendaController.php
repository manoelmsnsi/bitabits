<?php class Renda extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }  public function admin_listar(){        $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Renda/admin_listar/';        if($acesso->acesso_valida($comando)==true){             $filiais=$acesso->acesso_filial("Renda");            $acesso = new SessionHelper();                     if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();            $form = new FormularioHelper();            $renda = new RendaModel();            $inputs=$form->Listar($classe, $titulo, $action, $icone, $renda->listar_Renda(NULL,NULL,"id_status<>99 AND ({$filiais})",NULL,' Renda.id DESC',NULL,null,$pesquisa), $id, $acao, $pesquisa);            $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","library_books");                                  $logs->cadastrar_logs($comando,'0');//Gera Logs              }else{            $this->view('error_permisao');        }    }           public function form(){         $this->acesso_restrito();        $acesso = new AcessoHelper();                 $comando="/".__CLASS__."/incluir/";          if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){                $logs = new LogsModel();             $status= new StatusModel();            $renda= new RendaModel();            $filial = new FilialModel();            $acesso = new SessionHelper();            $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();            $id=$this->getParams("id");                  $nome_form="Cadastra Renda";            if(!empty($id)){                $renda_dados=$renda->listar_Renda($join, "1", "id='$id'", $offset, $orderby);                $renda_dados= $renda_dados[0];                 $comando="/".__CLASS__."/alterar/";                $nome_form="Alterar Renda";            }                        $form = new FormularioHelper();            $inputs.= $form->Input("hidden", "id", null, $id, $Required, null, $disable);            $inputs.= $form->select("Filial","id_filial", "col-md-2", $filial->listar_Filial(NULL,NULL,"id_status<>99",NULL,' id ASC',NULL),"nome_fantasia");            $inputs.= $form->Input("number", "valor", "col-md-1", $renda_dados["valor"], $Required, "Valor", $disable);                       $inputs.= $form->Input("number", "comissao", "col-md-1", $renda_dados["comissao"], $Required, "Comissão", $disable);                         $inputs.= $form->Input("text", "tabela", "col-md-2", $renda_dados["tabela"], $Required, "Tabela", $disable);            $inputs.= $form->Input("number", "id_tabela", "col-md-2", $renda_dados["id_tabela"], $Required, "Id Tabela", $disable);            $inputs.= $form->Input("date", "data_cargo", "col-md-2", $renda_dados["data_cargo"], $Required, "Criação Cargo", $disable);            $inputs.= $form->select("Status","id_status", "col-md-2", $status->listar_Status(NULL,NULL,"id_status<>99 AND tabela='Geral'",NULL,' Status.id ASC',NULL),"descricao");            $inputs.= $form->Button("btn btn-md btn-rose ","Salvar");             $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","library_books");        }else{           $this->view('error_permisao');        }       }     public function incluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Renda/incluir/';           if($acesso->acesso_valida($comando)==true){            $renda = new RendaModel();                  $id=$renda->cadastrar_renda(                 array(                    'id_filial'=>$_POST['id_filial'],                    'id_tabela'=>$_POST['id_tabela'],                    'tabela'=>$_POST['tabela'],                    'valor'=>$_POST['valor'],                    'comissao'=>$_POST['comissao'],                    'id_status'=>$_POST['id_status'],                    'data_cargo'=>$_POST['data_cargo'],                    'data_lancamento'=>  date("Y-m-d H:i:s"),                )            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Renda/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function alterar(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Renda/alterar/';        if($acesso->acesso_valida($comando)==true){            $id = $_POST['id'];            $renda = new RendaModel();                  $renda->alterar_renda(                array(                     'id_filial'=>$_POST['id_filial'],                    'id_tabela'=>$_POST['id_tabela'],                    'tabela'=>$_POST['tabela'],                    'valor'=>$_POST['valor'],                    'comissao'=>$_POST['comissao'],                    'id_status'=>$_POST['id_status'],                    'data_cargo'=>$_POST['data_cargo'],                   'data_lancamento'=>  date("Y-m-d H:i:s"),                ),'id='.$id            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Renda/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Renda/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $renda = new RendaModel();                  $renda->excluir_renda( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Renda/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 