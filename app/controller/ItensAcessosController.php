<?phpclass ItensAcessos extends Controller {      private  $auth,$db;    public function init(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction("Admin", "login")             ->checkLogin("redirect");                      $this->db = new AdminModel();    }    public function index_action(){                }        public function admin_listar(){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){             $filiais=$acesso->acesso_filial(__CLASS__);            $status= new StatusModel();            $filial = new FilialModel();                       $acesso = new SessionHelper();                       $itens_acesso = new ItensAcessosModel();            if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                        $form = new FormularioHelper();                 $inputs= $form->Listar("col-md-12", null, "/".__CLASS__."/form/", $icone,$itens_acesso->listar_itens_acessos("INNER JOIN Status ON Status.id= itensAcesso.id_status INNER JOIN Usuarios ON Usuarios.id = ItensAcesso.id_usuario INNER JOIN Programas ON Programas.id=ItensAcesso.id_programa",NULL,"  {$filiais}",NULL," ItensAcesso.id DESC","Programas.descricao AS Programa,Usuarios.nome AS Usuario, Programas.comando AS Comando,ItensAcesso.id,ItensAcesso.data_lancamento AS Lancamento,Status.cor AS cor_Status,Status.Descricao AS Status",NULL,$pesquisa), "tabela1", array(array("acao"=>"/".__CLASS__."/form/","classe"=>"btn-sm btn-warning","icone"=>"edit"),array("acao"=>"/".__CLASS__."/visualizar/","classe"=>"btn-sm btn-rose","icone"=>"remove_red_eye"),array("acao"=>"/Logs/form/","classe"=>"btn-sm btn-danger","icone"=>"close")));            $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","ballot");        }else{            $this->view('error_permisao');        }        }        public function form(){        $acesso = new SessionHelper();        $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                echo $menu->Menu();                $itens_acessos = new ItensAcessosModel();        $usuarios = new UsuariosModel();        $listar_usuarios = $usuarios->listar_usuarios(NULL,NULL,"id_status=1",NULL," Usuarios.id DESC");        $dados["listar_usuarios"] = $listar_usuarios;                 $programas = new ProgramasModel();        $listar_programas = $programas->listar_programas(NULL,NULL,"id_status=1",NULL," Programas.id DESC");        $dados["listar_programas"] = $listar_programas;                    $id = $this->getParams("id");                if(!empty($id)){            $dados["id"]=$id;            $listar_itens_acessos = $itens_acessos->listar_itens_acessos("INNER JOIN Usuarios ON Usuarios.id = ItensAcessos.id_usuario INNER JOIN Programas ON Programas.id=ItensAcessos.id_programa",NULL,"ItensAcessos.id ={$id}",NULL," ItensAcessos.id DESC", "Programas.descricao,Usuarios.nome, Programas.comando,Programas.id AS id_programa,ItensAcessos.id,ItensAcessos.id_usuario,ItensAcessos.filho,ItensAcessos.id_grupo,ItensAcessos.data_lancamento,ItensAcessos.id_status");            $dados["listar_itens_acessos"] = $listar_itens_acessos;                       $listar_itens_filho = $itens_acessos->listar_itens_acessos("INNER JOIN Usuarios ON Usuarios.id = ItensAcessos.id_usuario INNER JOIN Programas ON Programas.id=ItensAcessos.id_programa",NULL,"ItensAcessos.filho ='0'",NULL," ItensAcessos.id DESC", "Programas.descricao,Usuarios.nome, Programas.comando,Programas.id AS id_programa,ItensAcessos.id,ItensAcessos.id_usuario,ItensAcessos.filho,ItensAcessos.id_grupo,ItensAcessos.data_lancamento,ItensAcessos.id_status");            $dados["listar_filho"] = $listar_itens_filho;        }        $this->view("form_itens_acessos",$dados);    }      public function incluir(){          $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/ItensAcessos/incluir/";                if($acesso->acesso_valida($comando)==true){             $itens_acessos = new ItensAcessosModel();                    $id=$itens_acessos->insert(array(                "id_programa" => $_POST["id_programa"],                               "id_usuario" => $_POST["id_usuario"],                "id_grupo" => $_POST["id_grupo"],                "data_lancamento" => date("Y-m-d H:i:s"),                "id_status" => "1"));                        $logs->incluir($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl("/ItensAcessos/admin_listar/");        }else{            $this->view("error_permisao");        }    }    public function alterar(){         $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/ItensAcessos/alterar/";              if($acesso->acesso_valida($comando)==true){             $id = $this->getParams("id");            $itens_acessos = new ItensAcessosModel();                   $itens_acessos->update(array(                "id_programa" => $_POST["id_programa"],                "id_usuario" => $_POST["id_usuario"],                "id_grupo" => $_POST["id_grupo"],                "data_lancamento" => date("Y-m-d"),                "id_status" => "1"), "id={$id}");                        $logs->incluir($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl("/ItensAcessos/admin_listar/");        }else{            $this->view("error_permisao");        }           }    public function excluir(){         $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/ItensAcessos/excluir/";                if($acesso->acesso_valida($comando)==true){             $id = $this->getParams("id");            $itens_acessos = new ItensAcessosModel();                   $itens_acessos->update(array(                "id_status" => "99"), "id={$id}");                       $logs->incluir($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl("/ItensAcessos/admin_listar/");        }else{            $this->view("error_permisao");        }    } }