<?php class Tutorial extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }      public function admin_listar(){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){             $filiais=$acesso->acesso_filial(__CLASS__);            $status= new StatusModel();            $filial = new FilialModel();                       $acesso = new SessionHelper();                       $tutorial = new TutorialModel();            if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                        $form = new FormularioHelper();                 $inputs = $form->Listar("col-md-12", null, "/".__CLASS__."/form/", $icone,$tutorial->listar_Tutorial(NULL,NULL,"id_status<>99 ",NULL,' Tutorial.id DESC',"id,menu AS 'Menu',observacao AS 'Observação',data_lancamento AS 'Data Lançamento'",null,$pesquisa), "tabela1", array(array("acao"=>"/".__CLASS__."/form/","classe"=>"btn-sm btn-warning","icone"=>"edit"),array("acao"=>"/".__CLASS__."/visualizar/","classe"=>"btn-sm btn-rose","icone"=>"remove_red_eye"),array("acao"=>"/Logs/form/","classe"=>"btn-sm btn-danger","icone"=>"close")));            $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","queue_play_next");                    }else{            $this->view('error_permisao');        }        }    public function form(){         $this->acesso_restrito();        $acesso = new AcessoHelper();                 $comando="/".__CLASS__."/incluir/";          if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){               $logs = new LogsModel();                      $status= new StatusModel();            $filial = new FilialModel();            $programa = new ProgramaModel();            $tutorial = new TutorialModel();             $acesso = new SessionHelper();            $menu = new MenuHelper("B", $Class, $AcaoForm, $MetodoDeEnvio);                   echo $menu->Menu();            $id=$this->getParams("id");                $nome_form="Cadastra Tutorial";            if(!empty($id)){                $tutorial_dados=$tutorial->listar_Tutorial($join, "1", "id='$id'", $offset, $orderby);                $tutorial_dados= $tutorial_dados[0];                 $comando="/".__CLASS__."/alterar/";                $nome_form="Alterar Tutorial";            }                         $form = new FormularioHelper();            $inputs .= $form->Input("hidden", "id", null, $id, $Required, null, $disable);            $inputs .= $form->select("Programa","id_programa", "col-md-2",$programa->listar_programa($join, $limit, "id_status<>'99'", $offset, $orderby, $from),"descricao");            $inputs .= $form->Input("text", "observacao", "col-md-5", $tutorial_dados["observacao"], $Required, "Observação", $disable);            $inputs .= $form->Input("text", "menu", "col-md-3", $tutorial_dados["menu"], $Required, "Menu", $disable);            $inputs .= $form->select("Status","id_status", "col-md-2", $status->listar_Status(NULL,NULL,"id_status<>99 AND tabela='Geral'",NULL,' Status.id ASC',NULL),"descricao");            $inputs .= $form->Button("btn btn-md btn-rose ","Salvar");                               $form->card($nome_form,$inputs,"col-md-12",$comando,"POST","queue_play_next");          }else{           $this->view('error_permisao');        }       } public function visualizar(){         $this->acesso_restrito();        $acesso = new AcessoHelper();                 $comando="/".__CLASS__."/visualizar/";          if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){                $logs = new LogsModel();                        $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                        echo $menu->Menu();                  $id = $this->getParams('id');                $dados['id']=$id;                if(!empty($id)){                    $uploas = new TutorialModel();                    $listar_tutorial = $uploas->listar_Tutorial("INNER JOIN Upload ON Upload.id_tabela=Tutorial.id ",NULL,"Upload.tabela='Tutorial' AND Upload.id_tabela='$id' AND Tutorial.id_status='1'",NULL,'Upload.id DESC',"Upload.descricao,menu,src");                    $dados['listar_tutorial'] = $listar_tutorial;                }         }        $this->view('form_visualizar_tutorial',$dados);    } public function incluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Tutorial/incluir/';                  if($acesso->acesso_valida($comando)==true){            $tutorial = new TutorialModel();                  $id=$tutorial->cadastrar_tutorial(                 array(                    'id_programa'=>$_POST['id_programa'],                    'observacao'=>$_POST['observacao'],                    'menu'=>$_POST['menu'],                    'id_status'=>$_POST['id_status'],                    'data_lancamento'=>date('Y-m-d H:i:s'),                )            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Tutorial/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function alterar(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Tutorial/alterar/';        if($acesso->acesso_valida($comando)==true){            $id = $_POST['id'];            $tutorial = new TutorialModel();                  $tutorial->alterar_tutorial(                array(                    'id_programa'=>$_POST['id_programa'],                    'observacao'=>$_POST['observacao'],                    'menu'=>$_POST['menu'],                    'id_status'=>$_POST['id_status'],                    'data_lancamento'=>date('Y-m-d H:i:s'),                ),'id='.$id            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Tutorial/admin_listar/');            }else{            $this->view('error_permisao');        }    } public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Tutorial/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $tutorial = new TutorialModel();                  $tutorial->excluir_tutorial( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Tutorial/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 