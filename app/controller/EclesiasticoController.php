<?php class Eclesiastico extends Controller {       private  $auth,$db;    public function acesso_restrito(){                  $this->auth = new AutenticaHelper();        $this->auth->setLoginControllerAction('Index','')                   ->checkLogin('redirect');                      $this->db = new AdminModel();     }         public function admin_listar(){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/".__CLASS__."/admin_listar/")==true){             $filiais=$acesso->acesso_filial(__CLASS__);            $status= new StatusModel();            $filial = new FilialModel();                       $acesso = new SessionHelper();                       $eclesiastico = new EclesiasticoModel();                       if(empty($_POST["pesquisa"])){$pesquisa=null; }else{ $pesquisa=$_POST["pesquisa"]; }            $menu = new MenuHelper("Bit a Bits", $Class, $AcaoForm, $MetodoDeEnvio);                    echo $menu->Menu();                        $form = new FormularioHelper();                 $inputs.= $form->Listar("col-md-12", null, "/".__CLASS__."/form/", $icone,$eclesiastico->listar_Eclesiastico("INNER JOIN Status ON Status.id = Eclesiastico.id_status INNER JOIN Filial ON Filial.id = Eclesiastico.id_filial",NULL,"Eclesiastico.id_status<>99",NULL,' Eclesiastico.id DESC',"Eclesiastico.id,Eclesiastico.batismo_espirito,Eclesiastico.batismo_agua,Eclesiastico.data_conversao,Eclesiastico.id_tabela,Eclesiastico.tabela,Eclesiastico.data_lancamento,Status.cor AS cor_Status,Status.Descricao AS Status,Filial.nome_fantasia AS nome_filial",NULL,$pesquisa), "tabela1", array(array("acao"=>"/".__CLASS__."/form/","classe"=>"btn-sm btn-warning","icone"=>"edit"),array("acao"=>"/".__CLASS__."/visualizar/","classe"=>"btn-sm btn-rose","icone"=>"remove_red_eye"),array("acao"=>"/Logs/form/","classe"=>"btn-sm btn-danger","icone"=>"close")));            $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","ballot");        }else{            $this->view('error_permisao');        }        }public function form (){        $this->acesso_restrito();        $acesso = new AcessoHelper();        $logs = new LogsModel();        $comando="/".__CLASS__."/incluir/";                 if($acesso->acesso_valida("/Eclesiastico/admin_listar/")==true){        $status= new StatusModel();        $filial = new FilialModel();        $eclesiastico = new EclesiasticoModel();        $id=$this->getParams("id");                 $menu = new MenuHelper("Bitabits | Desenvolvimento", $Class, $AcaoForm, $MetodoDeEnvio);                echo $menu->Menu();        if(!empty($id)){            $eclesiastico_dados=$eclesiastico->listar_Eclesiastico($join, "1", "id=$id", $offset, $orderby);            $eclesiastico_dados= $eclesiastico_dados[0];             $comando="/".__CLASS__."/alterar/";        }                                $form = new FormularioHelper("Cadastro Eclesiástico","col-md-12" ,$comando,"POST","people");            $inputs.= $form->Input("hidden", "id", null, $id, $required,null);            $inputs.= $form->Input("hidden", "id_tabela", null, $this->getParams('id_tabela'), $required,null);                      $inputs.= $form->Input("hidden", "tabela", null, $this->getParams('tabela'), $required,null);                        $inputs.= $form->select("Filial","id_filial", "col-md-2", $filial->listar_Filial(NULL,NULL,"Filial.id_status<>'99'",NULL,' Filial.id DESC',NULL),"nome_fantasia");            $inputs.= $form->Input("text", "codigo_membro", "col-md-2", $eclesiastico_dados["codigo_membro"], "required","Cód. Membro");            $inputs.= $form->select("Tipo de Admissão","tipo_admissao", "col-md-2",array(array("id"=>"Batismo","descricao"=>"Batismo"),array("id"=>"Carta","descricao"=>"Carta"),array("id"=>"Reconciliação","descricao"=>"Reconciliação"),array("id"=>"Outros","descricao"=>"Outros")),"descricao");                                             $inputs.= $form->Input("date", "data_admissao", "col-md-2", $eclesiastico_dados["data_admissao"], $required,"Data de Admissão");            $inputs.= $form->Input("date", "data_emissao_carteira", "col-md-2", $eclesiastico_dados["data_emissao_carteira"], $required,"Emissão do Cartão");            $inputs.= $form->Input("date", "vencimento_carteira", "col-md-2", $eclesiastico_dados["vencimento_carteira"], $required,"Vencimento Cartão");            $inputs.= $form->Input("date", "data_conversao", "col-md-2", $eclesiastico_dados["data_conversao"], $required,"Data da Conversão");            $inputs.= $form->select("Batizado nas Águas?","batismo_agua", "col-md-2",array(array("id"=>"Sim","descricao"=>"Sim"),array("id"=>"Não","descricao"=>"Não")),"descricao");            $inputs.= $form->Input("date", "data_batismo_agua", "col-md-2", $eclesiastico_dados["data_batismo_agua"], $required,"Data");            $inputs.= $form->Input("text", "igreja_batismo", "col-md-3", $eclesiastico_dados["igreja_batismo"], $required,"Igreja do Batismo");            $inputs.= $form->Input("text", "cidade_batismo", "col-md-3", $eclesiastico_dados["cidade_batismo"], $required,"Cidade do Batismo");            $inputs.= $form->select("Batizado no Espirito Santo?","batismo_espirito", "col-md-2",array(array("id"=>"Sim","descricao"=>"Sim"),array("id"=>"Não","descricao"=>"Não")),"descricao");                        $inputs.= $form->Input("date", "data_batismo_espirito", "col-md-2", $eclesiastico_dados["data_batismo_espirito"], $required,"Data");            $inputs.= $form->Input("text", "classe_ebd", "col-md-2", $eclesiastico_dados["classe_ebd"], $required,"Classe EBD");                       $inputs.= $form->select("Status","id_status", "col-md-3", $status->listar_Status(NULL,NULL,"id_status<>99 AND tabela='Geral'",NULL,' Status.id ASC',NULL),"descricao");            $inputs.= $form->Input("text", "observacoes", "col-md-12", $eclesiastico_dados["observacoes"], $required,"Observações");                       $inputs.= $form->Button("btn btn-md btn-rose ","Salvar");            $form->card(__CLASS__,$inputs,"col-md-12",$comando,"POST","ballot");            }else{               $this->view('error_permisao');           }     }   public function incluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Eclesiastico/incluir/';              $id_tabela=$_POST['id_tabela'];        $tabela=$_POST['tabela'];                  if($acesso->acesso_valida($comando)==true){            $eclesiastico = new EclesiasticoModel();                  $id=$eclesiastico->cadastrar_eclesiastico(                 array(                    'id_filial'=>$_POST['id_filial'],                    'id_status'=>$_POST['id_status'],                    'id_tabela'=>$id_tabela,                                        'data_admissao'=>$_POST['data_admissao'],                    'tipo_admissao'=>$_POST['tipo_admissao'],                    'data_emissao_carteira'=>$_POST['data_emissao_carteira'],                    'vencimento_carteira'=>$_POST['vencimento_carteira'],                    'codigo_membro'=>$_POST['codigo_membro'],                    'batismo_espirito'=>$_POST['batismo_espirito'],                    'data_batismo_espirito'=>$_POST['data_batismo_espirito'],                    'batismo_agua'=>$_POST['batismo_agua'],                    'data_batismo_agua'=>$_POST['data_batismo_agua'],                    'cidade_batismo'=>$_POST['cidade_batismo'],                    'igreja_batismo'=>$_POST['igreja_batismo'],                    'data_conversao'=>$_POST['data_conversao'],                    'classe_ebd'=>$_POST['classe_ebd'],                    'tabela'=>$tabela,                         'observacoes'=>$_POST['observacoes'],                        'data_lancamento'=>  date("Y-m-d H:i:s"),                )            );                 $logs->cadastrar_logs($comando,$id);//Gera Logs               $redirect = new RedirectHelper();               $redirect->goToUrl("/Pessoa/visualizar/id/$id_tabela/tabela/$tabela");                                 }           else{               $this->view('error_permisao');           }       }     public function alterar(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Eclesiastico/alterar/';        if($acesso->acesso_valida($comando)==true){            $id = $_POST['id'];            $tabela = $_POST['tabela'];            $id_tabela = $_POST['id_tabela'];            $eclesiastico = new EclesiasticoModel();                  $eclesiastico->alterar_eclesiastico(                array(                    'id_filial'=>$_POST['id_filial'],                    'id_status'=>$_POST['id_status'],                    'id_tabela'=>$_POST['id_tabela'],                                        'data_admissao'=>$_POST['data_admissao'],                    'tipo_admissao'=>$_POST['tipo_admissao'],                    'data_emissao_carteira'=>$_POST['data_emissão_carteira'],                    'vencimento_carteira'=>$_POST['vencimento_carteira'],                    'codigo_membro'=>$_POST['codigo_membro'],                    'batismo_espirito'=>$_POST['batismo_espirito'],                    'data_batismo_espirito'=>$_POST['data_batismo_espirito'],                    'batismo_agua'=>$_POST['batismo_agua'],                    'data_batismo_agua'=>$_POST['data_batismo_agua'],                    'cidade_batismo'=>$_POST['cidade_batismo'],                    'igreja_batismo'=>$_POST['igreja_batismo'],                    'data_conversao'=>$_POST['data_conversao'],                    'classe_ebd'=>$_POST['classe_ebd'],                    'tabela'=>$_POST['tabela'],                         'observacoes'=>$_POST['observacoes'],                        'data_lancamento'=>  date("Y-m-d H:i:s"),                ),'id='.$id            );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl("/Pessoa/visualizar/id/$id_tabela/tabela/$tabela");            }else{            $this->view('error_permisao');        }    }     public function excluir(){            $this->acesso_restrito();        $acesso = new AcessoHelper();         $logs = new LogsModel();        $comando='/Eclesiastico/excluir/';        if($acesso->acesso_valida($comando)==true){            $id = $this->getParams('id');            $eclesiastico = new EclesiasticoModel();                  $eclesiastico->excluir_eclesiastico( array( 'id_status'=>'99' ),'id='.$id );              $logs->cadastrar_logs($comando,$id);//Gera Logs            $redirect = new RedirectHelper();            $redirect->goToUrl('/Eclesiastico/admin_listar/');            }else{            $this->view('error_permisao');        }    }  } ?> 